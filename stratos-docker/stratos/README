
#
# Start mysql docker container (skip this step if you have mysql already installed)
#

USERSTORE_ID=$(sudo docker run -d -p 3306:3306 -e MYSQL_ROOT_PASSWORD=password apachestratos/mysql); sleep 2s;
USERSTORE_IP=$(sudo docker inspect $USERSTORE_ID | grep IPAddress | cut -d '"' -f 4)

#
# Start Stratos
#

unset docker_env
docker_env+=(-e "USERSTORE_DB_HOSTNAME=${USERSTORE_IP}")
docker_env+=(-e "USERSTORE_DB_PORT=3306")
docker_env+=(-e "USERSTORE_DB_SCHEMA=USERSTORE_DB_SCHEMA")
docker_env+=(-e "USERSTORE_DB_USER=root")
docker_env+=(-e "USERSTORE_DB_PASS=password")

docker_env+=(-e "PUPPET_IP=192.168.56.5")
docker_env+=(-e "PUPPET_HOSTNAME=stratos.com")
docker_env+=(-e "PUPPET_ENVIRONMENT=none")

docker_env+=(-e "MB_HOSTNAME=192.168.56.5")
docker_env+=(-e "MB_PORT=61616")

docker_env+=(-e "EC2_ENABLED=true")
docker_env+=(-e "EC2_IDENTITY=abc")
docker_env+=(-e "EC2_CREDENTIAL=def")
docker_env+=(-e "EC2_CREDENTIAL=none")
docker_env+=(-e "EC2_OWNER_ID=none")
docker_env+=(-e "EC2_AVAILABILITY_ZONE=none")
docker_env+=(-e "EC2_SECURITY_GROUPS=none")
docker_env+=(-e "EC2_KEYPAIR=none")

container_id=$(sudo docker run -d "${docker_env[@]}" apachestratos/stratos)

sudo docker logs -f $container_id

